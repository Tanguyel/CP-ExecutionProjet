var CoursePress=CoursePress||{};!function(e){function s(){var s=e('[data-type="modal-step"]');void 0!==s&&s.length&&(CoursePress.Enrollment.Modal=Backbone.Modal.extend({template:_.template(e("#modal-template").html()),viewContainer:".enrollment-modal-container",submitEl:".done",cancelEl:".cancel",options:"meh",views:function(){var r={};return e.each(s,function(s,t){var n=s+1,o=e(t).attr("id");void 0!==o&&(r["click #step"+n]={view:_.template(e("#"+o).html()),onActive:"setActive"})}),r}(),events:{"click .previous":"previousStep","click .next":"nextStep","click .cancel-link":"closeDialog"},previousStep:function(e){e.preventDefault(),this.previous(),"function"==typeof this.onPrevious&&this.onPrevious()},nextStep:function(e){e.preventDefault(),this.next(),"function"==typeof this.onNext&&this.onNext()},closeDialog:function(){e(".enrolment-container-div").detach()},setActive:function(e){this.trigger("modal:updated",{view:this,options:e})},cancel:function(){e(".enrolment-container-div").detach()}}),CoursePress.Enrollment.dialog=new CoursePress.Enrollment.Modal,CoursePress.Enrollment.dialog.beforeSubmit=function(){var s=this.currentIndex;return t(s),s===CoursePress.Enrollment.dialog.views.length-1&&e(".enrolment-container-div").addClass("hidden"),!1},CoursePress.Enrollment.dialog.openAtAction=function(s){var r=e('[data-type="modal-step"]');e.each(r,function(r,t){var n=e(t).attr("data-modal-action");void 0!==n&&s===n&&CoursePress.Enrollment.dialog.openAt(r)})},CoursePress.Enrollment.dialog.on("modal:updated",function(){}),CoursePress.Enrollment.dialog.handle_signup_return=function(s){var r=s.signup_errors,t=e('[data-type="modal-step"]');if(0===r.length&&s.user_data.logged_in===!0)_coursepress.invitation_data?CoursePress.Enrollment.dialog.add_instructor(s):e.each(t,function(r,t){var n=e(t).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===n?CoursePress.Enrollment.dialog.openAt(r):"enrolled"===n&&(s.already_enrolled?location.href=_coursepress.course_url:CoursePress.Enrollment.dialog.attempt_enroll(s))});else if(r.length>0){e(".bbm-wrapper #error-messages").html("");var n="<ul>";r.forEach(function(e){n+="<li>"+e+"</li>"}),n+="</ul>",e(".bbm-wrapper #error-messages").html(n),e("input[name=password]").val(""),e("input[name=password_confirmation]").val("")}else e.each(t,function(e,s){var r=s.attr("data-modal-action");"login"===r&&CoursePress.Enrollment.dialog.openAt(e)})},CoursePress.Enrollment.dialog.handle_login_return=function(s){var r=s.signup_errors,t=e('[data-type="modal-step"]');if(0===r.length&&s.logged_in===!0)_coursepress.invitation_data?CoursePress.Enrollment.dialog.add_instructor(s):e.each(t,function(r,t){var n=e(t).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===n?CoursePress.Enrollment.dialog.openAt(r):"enrolled"===n&&(s.already_enrolled?location.href=_coursepress.course_url:CoursePress.Enrollment.dialog.attempt_enroll(s))});else if(r.length>0){e(".bbm-wrapper #error-messages").html("");var n="<ul>";r.forEach(function(e){n+="<li>"+e+"</li>"}),n+="</ul>",e(".bbm-wrapper #error-messages").html(n),e("input[name=password]").val("")}},CoursePress.Enrollment.dialog.handle_enroll_student_return=function(s){var r=e('[data-type="modal-step"]');!0===s.success&&e.each(r,function(s,r){var t=e(r).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===t?CoursePress.Enrollment.dialog.openAt(s):"enrolled"===t&&CoursePress.Enrollment.dialog.openAt(s)}),e(".enrolment-container-div").removeClass("hidden")},CoursePress.Enrollment.dialog.signup_validation=function(){var s=!0;e(".bbm-wrapper #error-messages").html("");var r=[];(""===e("input[name=first_name]").val().trim()||""===e("input[name=last_name]").val().trim()||""===e("input[name=username]").val().trim()||""===e("input[name=email]").val().trim()||""===e("input[name=password]").val().trim()||""===e("input[name=password_confirmation]").val().trim())&&(s=!1,r.push(_coursepress.signup_errors.all_fields));var t=CoursePress.utility.checkPasswordStrength(e("input[name=password]"),e("input[name=password_confirmation]"),e("#password-strength"),!1,[]);if(2>=t&&(s=!1,r.push(_coursepress.signup_errors.weak_password)),5===t&&(s=!1,r.push(_coursepress.signup_errors.mismatch_password)),r.length>0){var n="<ul>";r.forEach(function(e){n+="<li>"+e+"</li>"}),n+="</ul>",e(".bbm-wrapper #error-messages").html(n)}return s},CoursePress.Enrollment.dialog.login_validation=function(){var s=!0;return e(".bbm-wrapper #error-messages").html(""),(""===e("input[name=log]").val().trim()||""===e("input[name=pwd]").val().trim())&&(s=!1),s},CoursePress.Enrollment.dialog.signup_data=function(s){return s.first_name=e("input[name=first_name]").val(),s.last_name=e("input[name=last_name]").val(),s.username=e("input[name=username]").val(),s.email=e("input[name=email]").val(),s.password=e("input[name=password]").val(),s.nonce=e(".bbm-modal-nonce.signup").attr("data-nonce"),s},CoursePress.Enrollment.dialog.login_data=function(s){var r=e(".enrollment-modal-container.bbm-modal__views").attr("data-course");return s.username=e("input[name=log]").val(),s.password=e("input[name=pwd]").val(),s.course_id=r,s.nonce=e(".bbm-modal-nonce.login").attr("data-nonce"),s},CoursePress.Enrollment.dialog.attempt_enroll=function(s){var r=e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce"),t=e(".enrollment-modal-container.bbm-modal__views").attr("data-course");if(void 0===r||void 0===t){var n=e(document.createElement("div"));n.html(_.template(e("#modal-template").html())()),n=e(n).find(".enrollment-modal-container")[0],r=e(n).attr("data-nonce"),t=e(n).attr("data-course")}CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","enroll_student");var o={nonce:r,student_id:s.user_data.ID,course_id:t,step:""};CoursePress.Post.set("data",o),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:enroll_student_success"),CoursePress.Post.on("coursepress:enrollment:enroll_student_success",function(s){if(e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",s.nonce),void 0!==s.callback){var r=CoursePress.Enrollment.dialog[s.callback];if("function"==typeof r)return void r(s)}})},CoursePress.Enrollment.dialog.new_nonce=function(e,s){CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","get_nonce");var r={action:"get_nonce",nonce:e,step:""};CoursePress.Post.set("data",r),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:get_nonce_success"),CoursePress.Post.on("coursepress:enrollment:get_nonce_success",s)},CoursePress.Enrollment.dialog.add_instructor=function(e){CoursePress.Enrollment.dialog.new_nonce("coursepress_add_instructor",function(s){var r=_coursepress.invitation_data.course_id;CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","add_instructor");var t={action:"add_instructor",nonce:s.nonce,course_id:r,invite_code:_coursepress.invitation_data.code,instructor_id:e.user_data.ID,step:""};CoursePress.Post.set("data",t),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:add_instructor_success"),CoursePress.Post.on("coursepress:enrollment:add_instructor_success",function(){CoursePress.Enrollment.dialog.openAtAction("instructor-verified")}),CoursePress.Post.off("coursepress:enrollment:add_instructor_error"),CoursePress.Post.on("coursepress:enrollment:add_instructor_error",function(){CoursePress.Enrollment.dialog.openAtAction("verification-failed")})})},e("body").on("keyup","input[name=password], input[name=password_confirmation]",function(){CoursePress.utility.checkPasswordStrength(e("input[name=password]"),e("input[name=password_confirmation]"),e("#password-strength"),!1,[])}))}function r(){var s=e(document.createElement("div"));if(e("body").append(s),e(s).addClass("enrolment-container-div"),_coursepress.current_student>0)if("yes"===_coursepress.current_course_is_paid)e(s).html(CoursePress.Enrollment.dialog.render().el),CoursePress.Enrollment.dialog.openAtAction("paid_enrollment");else{e(s).addClass("hidden");var r={user_data:{ID:parseInt(_coursepress.current_student)}};CoursePress.Enrollment.dialog.attempt_enroll(r),e(s).html(CoursePress.Enrollment.dialog.render().el)}else e(s).html(CoursePress.Enrollment.dialog.render().el)}function t(s){if(void 0===s)return!1;var n,r=e(e('[data-type="modal-step"]')[s]).attr("data-modal-action"),t=e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce");if(CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action",r),!("signup"===r&&(n=CoursePress.Enrollment.dialog.signup_validation,"function"==typeof n&&!0!==n())||"login"===r&&(n=CoursePress.Enrollment.dialog.login_validation,"function"==typeof n&&!0!==n()))){var o={nonce:t,step:s};n=CoursePress.Enrollment.dialog[r+"_data"],"function"==typeof n&&(o=n(o)),CoursePress.Post.set("data",o),CoursePress.Post.save(),CoursePress.Post.on("coursepress:enrollment:"+r+"_success",function(s){return e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",s.nonce),void 0!==s.callback&&(n=CoursePress.Enrollment.dialog[s.callback],"function"==typeof n)?void n(s):void(void 0!==s.last_step&&parseInt(s.last_step)<CoursePress.Enrollment.dialog.views.length-1&&(CoursePress.Enrollment.dialog.openAt(parseInt(s.last_step)+1),e(".enrolment-container-div").removeClass("hidden")))}),CoursePress.Post.on("coursepress:enrollment:"+r+"_error",function(e){return void 0!==e.callback&&(n=CoursePress.Enrollment.dialog[e.callback],"function"==typeof n)?void n(e):void 0})}}function n(){CoursePress.Post.on("coursepress:notification:delete_success",function(){window.location.reload()})}function o(){e(".unit-archive-list-wrapper .section-title").on("click",function(){var s=e(e(e(this).parents(".unit-archive-single")[0]).find("a.unit-archive-single-title")[0]).attr("href"),r="section-"+e(this).attr("data-id"),t=e(this).find("a.unit-archive-single-title").length>0;t&&(window.location.href=s+"#"+r)}),e(".unit-archive-list-wrapper .module-title").on("click",function(){var s=e(e(e(this).parents(".unit-archive-single")[0]).find("a.unit-archive-single-title")[0]).attr("href"),r="module-"+e(this).attr("data-id"),t=e(this).find("a.unit-archive-single-title").length>0;if(t&&(window.location.href=s+"#"+r),"focus"==e(".unit-archive-list-wrapper").data("view-mode")){var n=e("a",e(this)).attr("href").split("#"),s=e(e(e(this).parents(".unit-archive-single")[0]).find("a.unit-archive-single-title")[0]).attr("href")+"#"+n[1];window.location.href=s}}),e(".apply-button.signup, .apply-button.enroll").on("click",function(e){e=e||window.event,e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),r()}),e(".apply-button").on("click",function(s){var r=s.currentTarget;e(r).attr("data-link")&&(window.location.href=e(r).attr("data-link"))}),e("button").on("click",function(s){var r=s.currentTarget;e(r).attr("data-link")&&(window.location.href=e(r).attr("data-link"))}),e(".course_list_box_item.clickable").on("click",function(s){var r=s.currentTarget;e(r).attr("data-link")&&(window.location.href=e(r).attr("data-link"))}),e(".li-locked-unit a").on("click",function(e){e.stopImmediatePropagation(),e.preventDefault()}),e(".workbook-table .view-response").link_popup({link_text:'<span class="dashicons dashicons-visibility"></span>',offset_x:-160}),e(".workbook-table .feedback").link_popup({link_text:'<span class="dashicons dashicons-admin-comments"></span>'}),a(),e(".course-message-container .course-message-close").on("click",function(){e(this).parent().slideUp()}),e(".unit-archive-single .fold").on("click",function(){var s=e(">ul",e(this).parent()),r=e(".unit-archive-single-title",e(this).parent()),t=e(".unit-archive-module-wrapper",e(this).parent()),n=e(this);return n.hasClass("folded")?s.slideDown(function(){n.removeClass("folded"),n.closest("li").removeClass("folded").addClass("unfolded"),r.attr("href",r.data("original-href")),r.off("click")}):s.slideUp(function(){if(n.addClass("folded"),n.closest("li").removeClass("unfolded").addClass("folded"),"undefined"==typeof r.data("href")){var s=e(".module-seen",t).last();if(s.length&&(s=e(".module-title",s),s.length))return r.attr("href",r.attr("href")+"#module-"+s.data("id")),!1;var o=e(".section-seen",t).last();if(o.length&&(o=e(".section-title",o),o.length))return r.attr("href",r.attr("href")+"#section-"+o.data("id")),!1}}),!1}),e(".course-structure .unit .fold").on("click",function(){var s=e(this),r=s.parents("li").first(),t=r.find(".unit-structure-modules"),n=r.is(".folded");n?(r.removeClass("folded").addClass("unfolded"),s.removeClass("folded"),t.slideDown()):(r.removeClass("unfolded").addClass("folded"),s.addClass("folded"),t.slideUp())}),e(".coursepress-focus-view #commentform #submit").unbind("click").on("click",function(){var r,s=e(this).closest("form");if(""==e("#comment",s).val())return alert(_coursepress.comments.require_valid_comment),!1;e("#respond #cancel-comment-reply-link").hide(),s.append('<div class="mask"><span><i class="fa fa-spinner fa-pulse"></i></span></div>'),r=e(".mask",s),r.css({width:s.width()+"px",height:s.height()+"px"}),e("span",r).css({marginTop:s.height()/2-20+"px"});var t=new CoursePress.Models.CourseFront;return t.set("action","comment_add_new"),t.set("comment_parent",e("#comment_parent",s).val()),t.set("comment_post_ID",e("#comment_post_ID",s).val()),t.set("comment_content",e("#comment",s).val()),t.set("coursepress_subscribe",e("[name=coursepress_subscribe]",s).val()),t.set("nonce",e("#coursepress-add-commment-nonce",s).val()),t.save(),t.off("coursepress:comment_add_new_success"),t.on("coursepress:comment_add_new_success",function(r){var t=e(".focus-nav-next.module-is-not-done");if("single-comment"==r.answer_mode){if(0==r.data.comment_parent){var n=e("#comments .comments-list");0<n.length?e("#comments .comments-list").prepend(r.data.html):CoursePress.FocusMode.init_focus_mode()}else comment_parent=e("#comment-"+r.data.comment_parent),0==e(".children",comment_parent).length&&comment_parent.append('<ul class="children"></ul>'),e(".children",comment_parent).first().append(r.data.html),e(".comments-list").before(e("#respond"));e("#comment").val(""),e("#comment_parent").val(0);var i,a=e("#comment-"+r.data.comment_id);0<a.length&&(i=a.offset().top,e(window).scrollTop(i))}else e("#comments .comments-list-container").html(r.data.html);o(),e(".mask",s).detach(),0<t.length&&(e(".coursepress-focus-view .focus-nav-next").replaceWith(r.data.next_nav),CoursePress.FocusMode.bind_focus_nav()),CoursePress.Events.trigger("coursepress:module_change",r)}),t.on("coursepress:comment_add_new_error",function(){r.detach(),e("#respond #cancel-comment-reply-link").show()}),!1}),e("label.file").on("change","input[type=file]",function(){var s=e("span",e(this).parent());return s.html(s.data(e(this).val().length?"change":"upload")),!0})}function a(){void 0!==_coursepress.marketpress_is_used&&"no"!==_coursepress.marketpress_is_used&&e("body.single-course button.mp_button-addcart").on("click",function(){var s=e(this).closest("form");return e.ajax({type:"POST",url:s.data("ajax-url"),data:{product:e("[name=product_id]",s).val(),cart_action:"add_item"}}).done(function(e){e.success&&void 0!==_coursepress.marketpress_cart_url&&window.location.assign(_coursepress.marketpress_cart_url)}),!1})}function i(){e(".module-container .module-result .resubmit a").on("click",function(){var s=e(this).parents(".module-container"),r=e(s).find(".module-elements"),t=e(s).find(".module-response"),n=e(s).find(".module-result");e(r).removeClass("hide"),e(t).addClass("hide"),e(n).addClass("hide")}),e(".module-container input[type=file]").on("change",function(){var s=e(this).parents(".module-container"),r=e(this).val(),t=r.split(".").pop(),n=_.keys(_coursepress.allowed_student_extensions),o=n.join(", "),a=e(s).find(".upload-progress"),i=_.contains(n,t),l=e(".module-submit-action",e(this).closest(".module-elements")).parent();e(a).find(".invalid-extension").detach(),i?l.closest("form").addClass("is-valid-file"):(e(a).append('<span class="invalid-extension">'+_coursepress.invalid_upload_message+o+"</span>"),l.closest("form").removeClass("is-valid-file"))}),e(".module-submit-action").on("click",function(){return})}function c(){var s=e("ul.units-archive-list a").css("color"),r=e("body").css("color").replace("rgb(","").replace(")","").split(","),t="rgba("+r[0]+", "+r[1]+", "+r[2]+", 1)";e(".course-progress-disc").each(function(){var r=e(this).data(),n=s,o="center",a=4.5,i=!0,l={duration:1200,easing:"circleProgressEase"};r.knobFgColor&&(s=r.knobFgColor),r.knobEmptyColor&&(t=r.knobEmptyColor),r.knobTextColor&&(n=r.knobTextColor),r.knobTextAlign&&(o=r.knobTextAlign),r.knobTextDenominator&&(a=r.knobTextDenominator),"undefined"!=typeof r.knobTextShow&&(i=r.knobTextShow),"undefined"!=typeof r.knobAnimation&&(l=r.knobAnimation);var u={color:s};e(this).circleProgress({fill:u,emptyFill:t,animation:l});e(this).parents("ul")[0];e(this).on("circle-animation-progress",function(s,r){var t=e(this).data("circle-progress"),l=t.ctx,u=t.size,c=(100*r).toFixed(),d=(100*t.value).toFixed();c=100-c,d>c&&(c=d),l.save(),i&&(l.font=u/a+"px sans-serif",l.textAlign=o,l.textBaseline="middle",l.fillStyle=n,l.fillText(c+"%",u/2+u/80,u/2)),l.restore()}),e(this).on("circle-animation-end",function(){var s=e(this).data("circle-progress"),r=s.ctx,t=s.size,l=(100*s.value).toFixed();s.drawFrame(s.value),i&&(r.font=t/a+"px sans-serif",r.textAlign=o,r.textBaseline="middle",r.fillStyle=n,r.fillText(l+"%",t/2,t/2))});var d=e(this).data("circle-progress"),f=d.ctx,p=d.size,m=(100*d.value).toFixed();i&&(f.font=p/a+"px sans-serif",f.textAlign=o,f.textBaseline="middle",f.fillStyle=n,f.fillText(m+"%",p/2,p/2+p/80)),"undefined"!=typeof r.knobTextPrepend&&r.knobTextPrepend&&e(this).parent().prepend('<span class="progress">'+m+"%</span>")})}function d(){e(".course-discussion-content.new .button-links .submit-discussion").on("click",function(){e(this).parents("form").submit()})}function p(){var s=e(".coursepress-focus-view");void 0!==s&&s.length>0&&CoursePress.FocusMode.init_focus_mode()}CoursePress.Models=CoursePress.Models||{},CoursePress.UI=CoursePress.UI||{},CoursePress.utility=CoursePress.utility||{},CoursePress.Events=CoursePress.Events||{},CoursePress.utility.timer_validate=function(e,s){var r="ref_"+(CoursePress.utility.hashcode(""+e)+"").split("").reverse().join("");return r===s},CoursePress.utility.checkPasswordStrength=function(e,s,r,t,n){var o=e.val(),a=s.val();t&&t.attr("disabled","disabled"),r.removeClass("short bad good strong"),n=n.concat(wp.passwordStrength.userInputBlacklist());var i=wp.passwordStrength.meter(o,n,a);switch(i){case 2:r.addClass("bad").html(pwsL10n.bad);break;case 3:r.addClass("good").html(pwsL10n.good);break;case 4:r.addClass("strong").html(pwsL10n.strong);break;case 5:r.addClass("short").html(pwsL10n.mismatch);break;default:r.addClass("short").html(pwsL10n.short)}return t&&i>2&&5!==i&&""!==a.trim()&&t.removeAttr("disabled"),i},CoursePress.actions=CoursePress.actions||{},CoursePress.filters=CoursePress.filters||{},CoursePress.add_action=function(e,s,r){void 0===r&&(r=10),CoursePress.actions[e]=CoursePress.actions[e]||[],CoursePress.actions[e].push({priority:r,callback:s})},CoursePress.add_filter=function(e,s,r){void 0===r&&(r=10),CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].push({priority:r,callback:s})},CoursePress.remove_action=function(e,s){CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].forEach(function(r,t){r.callback===s&&CoursePress.filters[e].splice(t,1)})},CoursePress.remove_filter=function(e,s){CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].forEach(function(r,t){r.callback===s&&CoursePress.filters[e].splice(t,1)})},CoursePress.do_action=function(e,s){var r=[];void 0!==CoursePress.actions[e]&&CoursePress.actions[e].length>0&&(CoursePress.actions[e].forEach(function(e){r[e.priority]=r[e.priority]||[],r[e.priority].push(e.callback)}),r.forEach(function(e){e.forEach(function(e){e(s)})}))},CoursePress.apply_filters=function(e,s,r){var t=[];return void 0!==CoursePress.filters[e]&&CoursePress.filters[e].length>0&&(CoursePress.filters[e].forEach(function(e){t[e.priority]=t[e.priority]||[],t[e.priority].push(e.callback)}),t.forEach(function(e){e.forEach(function(e){s=e(s,r)})})),s},CoursePress.Models.CourseFront=Backbone.Model.extend({url:_coursepress._ajax_url+"?action=course_front",parse:function(e){!0===e.success?(this.set("response_data",e.data),this.trigger("coursepress:"+e.data.action+"_success",e.data)):(this.set("response_data",{}),e.data&&this.trigger("coursepress:"+e.data.action+"_error",e.data))},defaults:{}}),CoursePress.Models.Post=CoursePress.Models.Post||Backbone.Model.extend({url:_coursepress._ajax_url+"?action=",parse:function(e){var s=this.get("context");if(!0===e.success){void 0===e.data&&(e.data={}),this.set("response_data",e.data);var r="coursepress:"+s+e.data.action+"_success";this.trigger(r,e.data)}else 0!==e&&(this.set("response_data",{}),this.trigger("coursepress:"+s+e.data.action+"_error",e.data));CoursePress.Post.set("action","")},prepare:function(e,s){this.url=this.get("base_url")+e,void 0!==s&&this.set("context",s)},defaults:{base_url:_coursepress._ajax_url+"?action=",context:"response:"}}),CoursePress.Post=new CoursePress.Models.Post,CoursePress.Enrollment=CoursePress.Enrollment||{},CoursePress.Page=CoursePress.Page||{},CoursePress.Enrollment.dialog=CoursePress.Enrollment.dialog||{},CoursePress.FocusMode=CoursePress.FocusMode||{},CoursePress.FocusMode.bind_focus_nav=function(){e(".coursepress-focus-view .focus-nav-prev").off("click"),e(".coursepress-focus-view .focus-nav-next").off("click"),e(".coursepress-focus-view .focus-nav-reload").off("click"),e(".coursepress-focus-view a.breadcrumb-course-unit-section.crumb").off("click"),e(".coursepress-focus-view a.nav-go-back-link").off("click"),e(".coursepress-focus-view a.nav-go-back-link").on("click",function(s){s.preventDefault();var r=e(this).attr("href");return window.location.href=r,window.location.reload(),!1}),e(".coursepress-focus-view .focus-nav-prev, .coursepress-focus-view .focus-nav-next, .coursepress-focus-view .focus-nav-reload").on("click",function(){if(e(this).hasClass("module-is-not-done")){s();var r=e(document.createElement("div"));return e("body").append(r),e(r).addClass("enrolment-container-div"),e(r).html(CoursePress.Enrollment.dialog.render().el),CoursePress.Enrollment.dialog.openAtAction("mandatory"),!1}var t=e(".coursepress-focus-view"),n=e(this).attr("data-type"),o=e(this).attr("data-id"),a=e(this).attr("data-unit"),i=t.attr("data-unit"),l=e(this).attr("data-url"),u=0;if(n||o){if(e(".coursepress-focus-view .loader").removeClass("hidden"),e(".coursepress-focus-view .focus-main").hide("fast"),a&&a.length&&l&&i&&a!==i)return e("body,html").animate({scrollTop:u,duration:100}),window.location.href=l,!1;l&&l.length&&t.attr("data-url",l),u=e(".entry-title").length>0?e(".entry-title").offset().top-32:32,u=CoursePress.apply_filters("coursepress_focus_top_offset",u),e("body,html").animate({scrollTop:u,duration:100}),CoursePress.FocusMode.load_focus_item(n,o)}}),e("a.breadcrumb-course-unit-section.crumb, a.breadcrumb-course-unit.crumb").on("click",function(){var s="section",r=e(this).attr("data-id");e(".coursepress-focus-view .loader").removeClass("hidden"),e(".coursepress-focus-view .focus-main").hide("fast");var t=0;t=e(".entry-title").length>0?e(".entry-title").offset().top-32:32,t=CoursePress.apply_filters("coursepress_focus_top_offset",t),e("body,html").animate({scrollTop:t,duration:100}),CoursePress.FocusMode.load_focus_item(s,r)})},CoursePress.FocusMode.load_focus_item=function(s,r){function a(){CoursePress.FocusMode.bind_focus_nav(),CoursePress.Page.init(),e("audio").css("visibility","visible"),e("audio").css("outline","none"),e(".quiz_timer").coursepress_timer({toggle_element:e(".quiz_timer").siblings(".module-quiz-questions"),seconds:parseInt(e(".quiz_timer").attr("data-time")),action:"none",running:!1}),e(".quiz_timer").on("timer_started",function(){}),e(".quiz_timer").on("timer_ended",function(){}),null!==location.hash.match(/^#comment-/)&&e("html, body").animate({scrollTop:e(location.hash).offset().top},0);var s=e(".course-structure-block ul.tree");s.length&&(e(".module",s).removeClass("current-module"),e(".module-"+n.item_id,s).addClass("current-module"));var r=e(".course-redirect-data");if(r.length&&"unit-not-available"==r.data("redirect")){var t=_coursepress.course_url_unit_nor_available;t+="&type="+r.data("type"),t+="&id="+r.data("id")}}CoursePress.Post.prepare("course_front","focus:"),CoursePress.Post.set("action","get_unit_"+s),(void 0===r||0===r.length)&&(r=1);var t=e(".coursepress-focus-view"),n={course_id:t.attr("data-course"),unit_id:t.attr("data-unit"),type:s,item_id:r},o=t.attr("data-url");o&&o.length&&(o=o.replace("http://","//").replace("https://","//"),window.history.replaceState("","CoursePress",o)),e(".coursepress-focus-view").load(_coursepress.home_url+"/coursepress_focus/"+n.course_id+"/"+n.unit_id+"/"+n.type+"/"+n.item_id,a)};var f=function(){var s=e(".course-structure-block");if(s.length>0){var r=s.data("nonce"),t=s.data(),n=t.course,o=window.location,a={data:t,course_id:n,nonce:r};e.get(o,a,function(e){s.replaceWith(e)})}};CoursePress.Events.on("coursepress:module_change",f),CoursePress.FocusMode.init_focus_mode=function(){var n,s=null!==location.hash.match(/^#module-/),r=null!==location.hash.match(/^#section-/),t=null!==location.hash.match(/^#comment-/);if(s||r||t||(r=!0),s&&(n=location.hash.replace("#module-",""),CoursePress.FocusMode.load_focus_item("module",n)),r){if(n=location.hash,void 0===n||0===n.length){var o=e(".coursepress-focus-view");n=e(o).attr("data-page")}n=n.replace("#section-",""),CoursePress.FocusMode.load_focus_item("section",n)}t&&(n=location.hash.replace("#comment-",""),CoursePress.FocusMode.load_focus_item("comment",n))},CoursePress.Page.init=function(){var s=e(".coursepress-focus-view").length>0;o(),i(),d(),c(),s||(e(".quiz_timer").coursepress_timer(),e(".quiz_timer").on("timer_started",function(){}),e(".quiz_timer").on("timer_ended",function(){}))},CoursePress.toggleModule=function(){var s=e(this),r=s.data("module"),t=e("#cp-element-"+r),n=e("#cp-response-"+r);return n.addClass("hide"),t.removeClass("hide"),!1},e(document).ready(function(){CoursePress.Page.init(),s(),p(),n(),bind_formule_swicher();var r=e("#cp-unsubscribe-message");r.length>0&&(e('<div class="enrolment-container-div">').html(CoursePress.Enrollment.dialog.render().el).appendTo("body"),CoursePress.Enrollment.dialog.openAtAction("unsubscribe"))}).on("click",".cp .button-reload-module",CoursePress.toggleModule),e(document).keydown(function(s){if(!(s.ctrlKey||s.altKey||s.shiftKey||s.metaKey)){var r=e(":focus");if(0<r.length){if(r.is("textarea"))return;if(r.is("input"))return}switch(s.which){case 37:e(".focus-nav .focus-nav-prev a").length>0&&e(".focus-nav .focus-nav-prev a").trigger("click");break;case 39:e(".focus-nav .focus-nav-next a").length>0&&e(".focus-nav .focus-nav-next a").trigger("click")}}})}(jQuery),CoursePress.current=CoursePress.current||{};