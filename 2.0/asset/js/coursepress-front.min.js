var CoursePress=CoursePress||{};!function(e){function s(){var s=e('[data-type="modal-step"]');void 0!==s&&s.length&&(CoursePress.Enrollment.Modal=Backbone.Modal.extend({template:_.template(e("#modal-template").html()),viewContainer:".enrollment-modal-container",submitEl:".done",cancelEl:".cancel",options:"meh",views:function(){var t={};return e.each(s,function(s,r){var o=s+1,n=e(r).attr("id");void 0!==n&&(t["click #step"+o]={view:_.template(e("#"+n).html()),onActive:"setActive"})}),t}(),events:{"click .previous":"previousStep","click .next":"nextStep","click .cancel-link":"closeDialog"},previousStep:function(e){e.preventDefault(),this.previous(),"function"==typeof this.onPrevious&&this.onPrevious()},nextStep:function(e){e.preventDefault(),this.next(),"function"==typeof this.onNext&&this.onNext()},closeDialog:function(){e(".enrolment-container-div").detach()},setActive:function(e){this.trigger("modal:updated",{view:this,options:e})},cancel:function(){e(".enrolment-container-div").detach()}}),CoursePress.Enrollment.dialog=new CoursePress.Enrollment.Modal,CoursePress.Enrollment.dialog.beforeSubmit=function(){var s=this.currentIndex;return r(s),s===CoursePress.Enrollment.dialog.views.length-1&&e(".enrolment-container-div").addClass("hidden"),!1},CoursePress.Enrollment.dialog.openAtAction=function(s){var t=e('[data-type="modal-step"]');e.each(t,function(t,r){var o=e(r).attr("data-modal-action");void 0!==o&&s===o&&CoursePress.Enrollment.dialog.openAt(t)})},CoursePress.Enrollment.dialog.on("modal:updated",function(){}),CoursePress.Enrollment.dialog.handle_signup_return=function(s){var t=s.signup_errors,r=e('[data-type="modal-step"]');if(0===t.length&&s.user_data.logged_in===!0)_coursepress.invitation_data?CoursePress.Enrollment.dialog.add_instructor(s):e.each(r,function(t,r){var o=e(r).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===o?CoursePress.Enrollment.dialog.openAt(t):"enrolled"===o&&(s.already_enrolled?location.href=_coursepress.course_url:CoursePress.Enrollment.dialog.attempt_enroll(s))});else if(t.length>0){e(".bbm-wrapper #error-messages").html("");var o="<ul>";t.forEach(function(e){o+="<li>"+e+"</li>"}),o+="</ul>",e(".bbm-wrapper #error-messages").html(o),e("input[name=password]").val(""),e("input[name=password_confirmation]").val("")}else e.each(r,function(e,s){var t=s.attr("data-modal-action");"login"===t&&CoursePress.Enrollment.dialog.openAt(e)})},CoursePress.Enrollment.dialog.handle_login_return=function(s){var t=s.signup_errors,r=e('[data-type="modal-step"]');if(0===t.length&&s.logged_in===!0)_coursepress.invitation_data?CoursePress.Enrollment.dialog.add_instructor(s):e.each(r,function(t,r){var o=e(r).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===o?CoursePress.Enrollment.dialog.openAt(t):"enrolled"===o&&(s.already_enrolled?location.href=_coursepress.course_url:CoursePress.Enrollment.dialog.attempt_enroll(s))});else if(t.length>0){e(".bbm-wrapper #error-messages").html("");var o="<ul>";t.forEach(function(e){o+="<li>"+e+"</li>"}),o+="</ul>",e(".bbm-wrapper #error-messages").html(o),e("input[name=password]").val("")}},CoursePress.Enrollment.dialog.handle_enroll_student_return=function(s){var t=e('[data-type="modal-step"]');!0===s.success&&e.each(t,function(s,t){var r=e(t).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===r?CoursePress.Enrollment.dialog.openAt(s):"enrolled"===r&&CoursePress.Enrollment.dialog.openAt(s)}),e(".enrolment-container-div").removeClass("hidden")},CoursePress.Enrollment.dialog.signup_validation=function(){var s=!0;e(".bbm-wrapper #error-messages").html("");var t=[];(""===e("input[name=first_name]").val().trim()||""===e("input[name=last_name]").val().trim()||""===e("input[name=username]").val().trim()||""===e("input[name=email]").val().trim()||""===e("input[name=password]").val().trim()||""===e("input[name=password_confirmation]").val().trim())&&(s=!1,t.push(_coursepress.signup_errors.all_fields));var r=CoursePress.utility.checkPasswordStrength(e("input[name=password]"),e("input[name=password_confirmation]"),e("#password-strength"),!1,[]);if(2>=r&&(s=!1,t.push(_coursepress.signup_errors.weak_password)),5===r&&(s=!1,t.push(_coursepress.signup_errors.mismatch_password)),t.length>0){var o="<ul>";t.forEach(function(e){o+="<li>"+e+"</li>"}),o+="</ul>",e(".bbm-wrapper #error-messages").html(o)}return s},CoursePress.Enrollment.dialog.login_validation=function(){var s=!0;return e(".bbm-wrapper #error-messages").html(""),(""===e("input[name=log]").val().trim()||""===e("input[name=pwd]").val().trim())&&(s=!1),s},CoursePress.Enrollment.dialog.signup_data=function(s){return s.first_name=e("input[name=first_name]").val(),s.last_name=e("input[name=last_name]").val(),s.username=e("input[name=username]").val(),s.email=e("input[name=email]").val(),s.password=e("input[name=password]").val(),s.nonce=e(".bbm-modal-nonce.signup").attr("data-nonce"),s},CoursePress.Enrollment.dialog.login_data=function(s){var t=e(".enrollment-modal-container.bbm-modal__views").attr("data-course");return s.username=e("input[name=log]").val(),s.password=e("input[name=pwd]").val(),s.course_id=t,s.nonce=e(".bbm-modal-nonce.login").attr("data-nonce"),s},CoursePress.Enrollment.dialog.attempt_enroll=function(s){var t=e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce"),r=e(".enrollment-modal-container.bbm-modal__views").attr("data-course");if(void 0===t||void 0===r){var o=e(document.createElement("div"));o.html(_.template(e("#modal-template").html())()),o=e(o).find(".enrollment-modal-container")[0],t=e(o).attr("data-nonce"),r=e(o).attr("data-course")}CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","enroll_student");var n={nonce:t,student_id:s.user_data.ID,course_id:r,step:""};CoursePress.Post.set("data",n),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:enroll_student_success"),CoursePress.Post.on("coursepress:enrollment:enroll_student_success",function(s){if(e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",s.nonce),void 0!==s.callback){var t=CoursePress.Enrollment.dialog[s.callback];if("function"==typeof t)return void t(s)}})},CoursePress.Enrollment.dialog.new_nonce=function(e,s){CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","get_nonce");var t={action:"get_nonce",nonce:e,step:""};CoursePress.Post.set("data",t),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:get_nonce_success"),CoursePress.Post.on("coursepress:enrollment:get_nonce_success",s)},CoursePress.Enrollment.dialog.add_instructor=function(e){CoursePress.Enrollment.dialog.new_nonce("coursepress_add_instructor",function(s){var t=_coursepress.invitation_data.course_id;CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","add_instructor");var r={action:"add_instructor",nonce:s.nonce,course_id:t,invite_code:_coursepress.invitation_data.code,instructor_id:e.user_data.ID,step:""};CoursePress.Post.set("data",r),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:add_instructor_success"),CoursePress.Post.on("coursepress:enrollment:add_instructor_success",function(){CoursePress.Enrollment.dialog.openAtAction("instructor-verified")}),CoursePress.Post.off("coursepress:enrollment:add_instructor_error"),CoursePress.Post.on("coursepress:enrollment:add_instructor_error",function(){CoursePress.Enrollment.dialog.openAtAction("verification-failed")})})},e("body").on("keyup","input[name=password], input[name=password_confirmation]",function(){CoursePress.utility.checkPasswordStrength(e("input[name=password]"),e("input[name=password_confirmation]"),e("#password-strength"),!1,[])}))}function t(){var s=e(document.createElement("div"));if(e("body").append(s),e(s).addClass("enrolment-container-div"),_coursepress.current_student>0)if("yes"===_coursepress.current_course_is_paid)e(s).html(CoursePress.Enrollment.dialog.render().el),CoursePress.Enrollment.dialog.openAtAction("paid_enrollment");else{e(s).addClass("hidden");var t={user_data:{ID:parseInt(_coursepress.current_student)}};CoursePress.Enrollment.dialog.attempt_enroll(t),e(s).html(CoursePress.Enrollment.dialog.render().el)}else e(s).html(CoursePress.Enrollment.dialog.render().el)}function r(s){if(void 0===s)return!1;var o,t=e(e('[data-type="modal-step"]')[s]).attr("data-modal-action"),r=e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce");if(CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action",t),!("signup"===t&&(o=CoursePress.Enrollment.dialog.signup_validation,"function"==typeof o&&!0!==o())||"login"===t&&(o=CoursePress.Enrollment.dialog.login_validation,"function"==typeof o&&!0!==o()))){var n={nonce:r,step:s};o=CoursePress.Enrollment.dialog[t+"_data"],"function"==typeof o&&(n=o(n)),CoursePress.Post.set("data",n),CoursePress.Post.save(),CoursePress.Post.on("coursepress:enrollment:"+t+"_success",function(s){return e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",s.nonce),void 0!==s.callback&&(o=CoursePress.Enrollment.dialog[s.callback],"function"==typeof o)?void o(s):void(void 0!==s.last_step&&parseInt(s.last_step)<CoursePress.Enrollment.dialog.views.length-1&&(CoursePress.Enrollment.dialog.openAt(parseInt(s.last_step)+1),e(".enrolment-container-div").removeClass("hidden")))}),CoursePress.Post.on("coursepress:enrollment:"+t+"_error",function(e){return void 0!==e.callback&&(o=CoursePress.Enrollment.dialog[e.callback],"function"==typeof o)?void o(e):void 0})}}function o(){CoursePress.Post.on("coursepress:notification:delete_success",function(){window.location.reload()})}function n(){e(".unit-archive-list-wrapper .section-title").on("click",function(){var s=e(e(e(this).parents(".unit-archive-single")[0]).find("a.unit-archive-single-title")[0]).attr("href"),t="section-"+e(this).attr("data-id"),r=e(this).find("a.unit-archive-single-title").length>0;r&&(window.location.href=s+"#"+t)}),e(".unit-archive-list-wrapper .module-title").on("click",function(){var s=e(e(e(this).parents(".unit-archive-single")[0]).find("a.unit-archive-single-title")[0]).attr("href"),t="module-"+e(this).attr("data-id"),r=e(this).find("a.unit-archive-single-title").length>0;if(r&&(window.location.href=s+"#"+t),"focus"==e(".unit-archive-list-wrapper").data("view-mode")){var o=e("a",e(this)).attr("href").split("#"),s=e(e(e(this).parents(".unit-archive-single")[0]).find("a.unit-archive-single-title")[0]).attr("href")+"#"+o[1];window.location.href=s}}),e(".apply-button.signup, .apply-button.enroll").on("click",function(e){e=e||window.event,e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t()}),e(".apply-button").on("click",function(s){var t=s.currentTarget;e(t).attr("data-link")&&(window.location.href=e(t).attr("data-link"))}),e("button").on("click",function(s){var t=s.currentTarget;e(t).attr("data-link")&&(window.location.href=e(t).attr("data-link"))}),e(".course_list_box_item.clickable").on("click",function(s){var t=s.currentTarget;e(t).attr("data-link")&&(window.location.href=e(t).attr("data-link"))}),e(".li-locked-unit a").on("click",function(e){e.stopImmediatePropagation(),e.preventDefault()}),e(".workbook-table .view-response").link_popup({link_text:'<span class="dashicons dashicons-visibility"></span>',offset_x:-160}),e(".workbook-table .feedback").link_popup({link_text:'<span class="dashicons dashicons-admin-comments"></span>'}),a(),e(".course-message-container .course-message-close").on("click",function(){e(this).parent().slideUp()}),e(".unit-archive-single .fold").on("click",function(){var s=e(">ul",e(this).parent()),t=e(".unit-archive-single-title",e(this).parent()),r=e(".unit-archive-module-wrapper",e(this).parent()),o=e(this);return o.hasClass("folded")?s.slideDown(function(){o.removeClass("folded"),o.closest("li").removeClass("folded").addClass("unfolded"),t.attr("href",t.data("original-href")),t.off("click")}):s.slideUp(function(){if(o.addClass("folded"),o.closest("li").removeClass("unfolded").addClass("folded"),"undefined"==typeof t.data("href")){var s=e(".module-seen",r).last();if(s.length&&(s=e(".module-title",s),s.length))return t.attr("href",t.attr("href")+"#module-"+s.data("id")),!1;var n=e(".section-seen",r).last();if(n.length&&(n=e(".section-title",n),n.length))return t.attr("href",t.attr("href")+"#section-"+n.data("id")),!1}}),!1}),e(".course-structure .unit .fold").on("click",function(){var s=e(this),t=s.parents("li").first(),r=t.find(".unit-structure-modules"),o=t.is(".folded");o?(t.removeClass("folded").addClass("unfolded"),s.removeClass("folded"),r.slideDown()):(t.removeClass("unfolded").addClass("folded"),s.addClass("folded"),r.slideUp())}),e(".coursepress-focus-view #commentform #submit").unbind("click").on("click",function(){var t,s=e(this).closest("form");if(""==e("#comment",s).val())return alert(_coursepress.comments.require_valid_comment),!1;e("#respond #cancel-comment-reply-link").hide(),s.append('<div class="mask"><span><i class="fa fa-spinner fa-pulse"></i></span></div>'),t=e(".mask",s),t.css({width:s.width()+"px",height:s.height()+"px"}),e("span",t).css({marginTop:s.height()/2-20+"px"});var r=new CoursePress.Models.CourseFront;return r.set("action","comment_add_new"),r.set("comment_parent",e("#comment_parent",s).val()),r.set("comment_post_ID",e("#comment_post_ID",s).val()),r.set("comment_content",e("#comment",s).val()),r.set("coursepress_subscribe",e("[name=coursepress_subscribe]",s).val()),r.set("nonce",e("#coursepress-add-commment-nonce",s).val()),r.save(),r.off("coursepress:comment_add_new_success"),r.on("coursepress:comment_add_new_success",function(t){var r=e(".focus-nav-next.module-is-not-done");if("single-comment"==t.answer_mode){if(0==t.data.comment_parent){var o=e("#comments .comments-list");0<o.length?e("#comments .comments-list").prepend(t.data.html):CoursePress.FocusMode.init_focus_mode()}else comment_parent=e("#comment-"+t.data.comment_parent),0==e(".children",comment_parent).length&&comment_parent.append('<ul class="children"></ul>'),e(".children",comment_parent).first().append(t.data.html),e(".comments-list").before(e("#respond"));e("#comment").val(""),e("#comment_parent").val(0);var i,a=e("#comment-"+t.data.comment_id);0<a.length&&(i=a.offset().top,e(window).scrollTop(i))}else e("#comments .comments-list-container").html(t.data.html);n(),e(".mask",s).detach(),0<r.length&&(e(".coursepress-focus-view .focus-nav-next").replaceWith(t.data.next_nav),CoursePress.FocusMode.bind_focus_nav()),CoursePress.Events.trigger("coursepress:module_change",t)}),r.on("coursepress:comment_add_new_error",function(){t.detach(),e("#respond #cancel-comment-reply-link").show()}),!1}),e("label.file").on("change","input[type=file]",function(){var s=e("span",e(this).parent());return s.html(s.data(e(this).val().length?"change":"upload")),!0})}function a(){void 0!==_coursepress.marketpress_is_used&&"no"!==_coursepress.marketpress_is_used&&e("body.single-course button.mp_button-addcart").on("click",function(){var s=e(this).closest("form");return e.ajax({type:"POST",url:s.data("ajax-url"),data:{product:e("[name=product_id]",s).val(),cart_action:"add_item"}}).done(function(e){e.success&&void 0!==_coursepress.marketpress_cart_url&&window.location.assign(_coursepress.marketpress_cart_url)}),!1})}function i(){e(".module-container .module-result .resubmit a").on("click",function(){var s=e(this).parents(".module-container"),t=e(s).find(".module-elements"),r=e(s).find(".module-response"),o=e(s).find(".module-result");e(t).removeClass("hide"),e(r).addClass("hide"),e(o).addClass("hide")}),e(".module-container input[type=file]").on("change",function(){var s=e(this).parents(".module-container"),t=e(this).val(),r=t.split(".").pop(),o=_.keys(_coursepress.allowed_student_extensions),n=o.join(", "),a=e(s).find(".upload-progress"),i=_.contains(o,r),c=e(".module-submit-action",e(this).closest(".module-elements")).parent();e(a).find(".invalid-extension").detach(),i?c.closest("form").addClass("is-valid-file"):(e(a).append('<span class="invalid-extension">'+_coursepress.invalid_upload_message+n+"</span>"),c.closest("form").removeClass("is-valid-file"))}),e(".module-submit-action").on("click",function(){return})}function l(){var s=e("ul.units-archive-list a").css("color"),t=e("body").css("color").replace("rgb(","").replace(")","").split(","),r="rgba("+t[0]+", "+t[1]+", "+t[2]+", 1)";e(".course-progress-disc").each(function(){var t=e(this).data(),o=s,n="center",a=4.5,i=!0,c={duration:1200,easing:"circleProgressEase"};t.knobFgColor&&(s=t.knobFgColor),t.knobEmptyColor&&(r=t.knobEmptyColor),t.knobTextColor&&(o=t.knobTextColor),t.knobTextAlign&&(n=t.knobTextAlign),t.knobTextDenominator&&(a=t.knobTextDenominator),"undefined"!=typeof t.knobTextShow&&(i=t.knobTextShow),"undefined"!=typeof t.knobAnimation&&(c=t.knobAnimation);var u={color:s};e(this).circleProgress({fill:u,emptyFill:r,animation:c});e(this).parents("ul")[0];e(this).on("circle-animation-progress",function(s,t){var r=e(this).data("circle-progress"),c=r.ctx,u=r.size,l=(100*t).toFixed(),d=(100*r.value).toFixed();l=100-l,d>l&&(l=d),c.save(),i&&(c.font=u/a+"px sans-serif",c.textAlign=n,c.textBaseline="middle",c.fillStyle=o,c.fillText(l+"%",u/2+u/80,u/2)),c.restore()}),e(this).on("circle-animation-end",function(){var s=e(this).data("circle-progress"),t=s.ctx,r=s.size,c=(100*s.value).toFixed();s.drawFrame(s.value),i&&(t.font=r/a+"px sans-serif",t.textAlign=n,t.textBaseline="middle",t.fillStyle=o,t.fillText(c+"%",r/2,r/2))});var d=e(this).data("circle-progress"),p=d.ctx,f=d.size,m=(100*d.value).toFixed();i&&(p.font=f/a+"px sans-serif",p.textAlign=n,p.textBaseline="middle",p.fillStyle=o,p.fillText(m+"%",f/2,f/2+f/80)),"undefined"!=typeof t.knobTextPrepend&&t.knobTextPrepend&&e(this).parent().prepend('<span class="progress">'+m+"%</span>")})}function d(){e(".course-discussion-content.new .button-links .submit-discussion").on("click",function(){e(this).parents("form").submit()})}function f(){var s=e(".coursepress-focus-view");void 0!==s&&s.length>0&&CoursePress.FocusMode.init_focus_mode()}CoursePress.Models=CoursePress.Models||{},CoursePress.UI=CoursePress.UI||{},CoursePress.utility=CoursePress.utility||{},CoursePress.Events=CoursePress.Events||{},CoursePress.utility.timer_validate=function(e,s){var t="ref_"+(CoursePress.utility.hashcode(""+e)+"").split("").reverse().join("");return t===s},CoursePress.utility.checkPasswordStrength=function(e,s,t,r,o){var n=e.val(),a=s.val();r&&r.attr("disabled","disabled"),t.removeClass("short bad good strong"),o=o.concat(wp.passwordStrength.userInputBlacklist());var i=wp.passwordStrength.meter(n,o,a);switch(i){case 2:t.addClass("bad").html(pwsL10n.bad);break;case 3:t.addClass("good").html(pwsL10n.good);break;case 4:t.addClass("strong").html(pwsL10n.strong);break;case 5:t.addClass("short").html(pwsL10n.mismatch);break;default:t.addClass("short").html(pwsL10n.short)}return r&&i>2&&5!==i&&""!==a.trim()&&r.removeAttr("disabled"),i},CoursePress.actions=CoursePress.actions||{},CoursePress.filters=CoursePress.filters||{},CoursePress.add_action=function(e,s,t){void 0===t&&(t=10),CoursePress.actions[e]=CoursePress.actions[e]||[],CoursePress.actions[e].push({priority:t,callback:s})},CoursePress.add_filter=function(e,s,t){void 0===t&&(t=10),CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].push({priority:t,callback:s})},CoursePress.remove_action=function(e,s){CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].forEach(function(t,r){t.callback===s&&CoursePress.filters[e].splice(r,1)})},CoursePress.remove_filter=function(e,s){CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].forEach(function(t,r){t.callback===s&&CoursePress.filters[e].splice(r,1)})},CoursePress.do_action=function(e,s){var t=[];void 0!==CoursePress.actions[e]&&CoursePress.actions[e].length>0&&(CoursePress.actions[e].forEach(function(e){t[e.priority]=t[e.priority]||[],t[e.priority].push(e.callback)}),t.forEach(function(e){e.forEach(function(e){e(s)})}))},CoursePress.apply_filters=function(e,s,t){var r=[];return void 0!==CoursePress.filters[e]&&CoursePress.filters[e].length>0&&(CoursePress.filters[e].forEach(function(e){r[e.priority]=r[e.priority]||[],r[e.priority].push(e.callback)}),r.forEach(function(e){e.forEach(function(e){s=e(s,t)})})),s},CoursePress.Models.CourseFront=Backbone.Model.extend({url:_coursepress._ajax_url+"?action=course_front",parse:function(e){!0===e.success?(this.set("response_data",e.data),this.trigger("coursepress:"+e.data.action+"_success",e.data)):(this.set("response_data",{}),e.data&&this.trigger("coursepress:"+e.data.action+"_error",e.data))},defaults:{}}),CoursePress.Models.Post=CoursePress.Models.Post||Backbone.Model.extend({url:_coursepress._ajax_url+"?action=",parse:function(e){var s=this.get("context");if(!0===e.success){void 0===e.data&&(e.data={}),this.set("response_data",e.data);var t="coursepress:"+s+e.data.action+"_success";this.trigger(t,e.data)}else 0!==e&&(this.set("response_data",{}),this.trigger("coursepress:"+s+e.data.action+"_error",e.data));CoursePress.Post.set("action","")},prepare:function(e,s){this.url=this.get("base_url")+e,void 0!==s&&this.set("context",s)},defaults:{base_url:_coursepress._ajax_url+"?action=",context:"response:"}}),CoursePress.Post=new CoursePress.Models.Post,CoursePress.Enrollment=CoursePress.Enrollment||{},CoursePress.Page=CoursePress.Page||{},CoursePress.Enrollment.dialog=CoursePress.Enrollment.dialog||{},CoursePress.FocusMode=CoursePress.FocusMode||{},CoursePress.FocusMode.bind_focus_nav=function(){e(".coursepress-focus-view .focus-nav-prev").off("click"),e(".coursepress-focus-view .focus-nav-next").off("click"),e(".coursepress-focus-view .focus-nav-reload").off("click"),e(".coursepress-focus-view a.breadcrumb-course-unit-section.crumb").off("click"),e(".coursepress-focus-view a.nav-go-back-link").off("click"),e(".coursepress-focus-view a.nav-go-back-link").on("click",function(s){s.preventDefault();var t=e(this).attr("href");return window.location.href=t,window.location.reload(),!1}),e(".coursepress-focus-view .focus-nav-prev, .coursepress-focus-view .focus-nav-next, .coursepress-focus-view .focus-nav-reload").on("click",function(){if(e(this).hasClass("module-is-not-done")){s();var t=e(document.createElement("div"));return e("body").append(t),e(t).addClass("enrolment-container-div"),e(t).html(CoursePress.Enrollment.dialog.render().el),CoursePress.Enrollment.dialog.openAtAction("mandatory"),!1}var r=e(".coursepress-focus-view"),o=e(this).attr("data-type"),n=e(this).attr("data-id"),a=e(this).attr("data-unit"),i=r.attr("data-unit"),c=e(this).attr("data-url"),u=0;if(o||n){if(e(".coursepress-focus-view .loader").removeClass("hidden"),e(".coursepress-focus-view .focus-main").hide("fast"),a&&a.length&&c&&i&&a!==i)return e("body,html").animate({scrollTop:u,duration:100}),window.location.href=c,!1;c&&c.length&&r.attr("data-url",c),u=e(".entry-title").length>0?e(".entry-title").offset().top-32:32,u=CoursePress.apply_filters("coursepress_focus_top_offset",u),e("body,html").animate({scrollTop:u,duration:100}),CoursePress.FocusMode.load_focus_item(o,n)}}),e("a.breadcrumb-course-unit-section.crumb, a.breadcrumb-course-unit.crumb").on("click",function(){var s="section",t=e(this).attr("data-id");e(".coursepress-focus-view .loader").removeClass("hidden"),e(".coursepress-focus-view .focus-main").hide("fast");var r=0;r=e(".entry-title").length>0?e(".entry-title").offset().top-32:32,r=CoursePress.apply_filters("coursepress_focus_top_offset",r),e("body,html").animate({scrollTop:r,duration:100}),CoursePress.FocusMode.load_focus_item(s,t)})},CoursePress.FocusMode.load_focus_item=function(s,t){function a(){CoursePress.FocusMode.bind_focus_nav(),CoursePress.Page.init(),e("audio").css("visibility","visible"),e("audio").css("outline","none"),e(".quiz_timer").coursepress_timer({toggle_element:e(".quiz_timer").siblings(".module-quiz-questions"),seconds:parseInt(e(".quiz_timer").attr("data-time")),action:"none",running:!1}),e(".quiz_timer").on("timer_started",function(){}),e(".quiz_timer").on("timer_ended",function(){}),null!==location.hash.match(/^#comment-/)&&e("html, body").animate({scrollTop:e(location.hash).offset().top},0);var s=e(".course-structure-block ul.tree");s.length&&(e(".module",s).removeClass("current-module"),e(".module-"+o.item_id,s).addClass("current-module"));var t=e(".course-redirect-data");if(t.length&&"unit-not-available"==t.data("redirect")){var r=_coursepress.course_url_unit_nor_available;r+="&type="+t.data("type"),r+="&id="+t.data("id")}}CoursePress.Post.prepare("course_front","focus:"),CoursePress.Post.set("action","get_unit_"+s),(void 0===t||0===t.length)&&(t=1);var r=e(".coursepress-focus-view"),o={course_id:r.attr("data-course"),unit_id:r.attr("data-unit"),type:s,item_id:t},n=r.attr("data-url");n&&n.length&&(n=n.replace("http://","//").replace("https://","//"),window.history.replaceState("","CoursePress",n)),e(".coursepress-focus-view").load(_coursepress.home_url+"/coursepress_focus/"+o.course_id+"/"+o.unit_id+"/"+o.type+"/"+o.item_id,a)};var p=function(){var s=e(".course-structure-block");if(s.length>0){var t=s.data("nonce"),r=s.data(),o=r.course,n=window.location,a={data:r,course_id:o,nonce:t};e.get(n,a,function(e){s.replaceWith(e)})}};CoursePress.Events.on("coursepress:module_change",p),CoursePress.FocusMode.init_focus_mode=function(){var o,s=null!==location.hash.match(/^#module-/),t=null!==location.hash.match(/^#section-/),r=null!==location.hash.match(/^#comment-/);if(s||t||r||(t=!0),s&&(o=location.hash.replace("#module-",""),CoursePress.FocusMode.load_focus_item("module",o)),t){if(o=location.hash,void 0===o||0===o.length){var n=e(".coursepress-focus-view");o=e(n).attr("data-page")}o=o.replace("#section-",""),CoursePress.FocusMode.load_focus_item("section",o)}r&&(o=location.hash.replace("#comment-",""),CoursePress.FocusMode.load_focus_item("comment",o))},CoursePress.Page.init=function(){var s=e(".coursepress-focus-view").length>0;n(),i(),d(),l(),s||(e(".quiz_timer").coursepress_timer(),e(".quiz_timer").on("timer_started",function(){}),e(".quiz_timer").on("timer_ended",function(){}))},CoursePress.toggleModule=function(){var s=e(this),t=s.data("module"),r=e("#cp-element-"+t),o=e("#cp-response-"+t);return o.addClass("hide"),r.removeClass("hide"),!1},e(document).ready(function(){CoursePress.Page.init(),s(),f(),o(),bind_formule_swicher();var t=e("#cp-unsubscribe-message");t.length>0&&(e('<div class="enrolment-container-div">').html(CoursePress.Enrollment.dialog.render().el).appendTo("body"),CoursePress.Enrollment.dialog.openAtAction("unsubscribe"))}).on("click",".cp .button-reload-module",CoursePress.toggleModule),e(document).keydown(function(s){if(!(s.ctrlKey||s.altKey||s.shiftKey||s.metaKey)){var t=e(":focus");if(0<t.length){if(t.is("textarea"))return;if(t.is("input"))return}switch(s.which){case 37:e(".focus-nav .focus-nav-prev a").length>0&&e(".focus-nav .focus-nav-prev a").trigger("click");break;case 39:e(".focus-nav .focus-nav-next a").length>0&&e(".focus-nav .focus-nav-next a").trigger("click")}}})}(jQuery),CoursePress.current=CoursePress.current||{};