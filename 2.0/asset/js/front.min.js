var CoursePress={};CoursePress.Models=CoursePress.Models||{},CoursePress.Events=_.extend({},Backbone.Events),CoursePress.UI=CoursePress.UI||{},CoursePress.utility=CoursePress.utility||{},function(e){CoursePress.SendRequest=Backbone.Model.extend({url:_coursepress._ajax_url+"?action=coursepress_request",parse:function(e){var s=this.get("action");!0===e.success?(this.set("response_data",e.data),this.trigger("coursepress:"+s+"_success",e.data)):(this.set("response_data",{}),this.trigger("coursepress:"+s+"_error",e.data))}}),CoursePress.resetBrowserURL=function(e){window.history.pushState&&window.history.pushState({},null,e)},CoursePress.Focus=function(s){var r,t=e(s);return 0<t.length&&(r=t.offset().top,r-=100,e(window).scrollTop(r)),!1},CoursePress.showError=function(s,t){var o,r=e('<div class="cp-error cp-error-box"></div>'),a=e("<p>"),n=e('<a class="cp-closed">&times;</a>'),i=e(".cp-error-box");0<i.length&&i.remove(),o=function(){r.remove()},a.html(s).appendTo(r),n.prependTo(r).on("click",o),t.prepend(r),CoursePress.Focus(".cp-error-box")},CoursePress.WindowAlert=Backbone.View.extend({className:"cp-mask cp-window-alert",message:"",callback:!1,type:"alert",html:'<div class="cp-alert-container"><p><button type="button" class="button">OK</button></p></div>',events:{"click .button":"remove","click .button-confirmed":"doCallback"},initialize:function(e){_.extend(this,e),Backbone.View.prototype.initialize.apply(this,arguments),this.render()},render:function(){this.container=new Backbone.View({className:"cp-alert-container"}),this.container=this.container.$el.appendTo(this.$el),this.container=this.$el.find(".cp-alert-container"),this.container.addClass("cp-"+this.type),this.container.prepend('<p class="msg">'+this.message+"</p>");var e=new Backbone.View({tagName:"button",attributes:{type:"button","class":"button"}});if(e.$el.html(_coursepress.buttons.ok),this.container.append(e.$el),"prompt"===this.type){var s=new Backbone.View({tagName:"button",attributes:{type:"button","class":"button button-cancel"}});s.$el.html(_coursepress.buttons.cancel),s.$el.insertBefore(e.$el),e.$el.addClass("button-confirmed")}this.$el.appendTo("body")},doCallback:function(){this.callback&&this.callback.apply(this.callback,this)}}),CoursePress.Mask=function(s){s=s?s:"body";var t=e('<div class="cp-mask mask"></div>');return t.appendTo(s),{mask:t,done:function(){t.remove()}}},CoursePress.UnitProgressIndicator=function(){var s=e("ul.units-archive-list a").css("color"),t=e("body").css("color").replace("rgb(","").replace(")","").split(","),r="rgba("+t[0]+", "+t[1]+", "+t[2]+", 1)",a=e(this).data(),n=s,i="center",o=4.5,l=!0,u={duration:1200,easing:"circleProgressEase"};a.knobFgColor&&(s=a.knobFgColor),a.knobEmptyColor&&(r=a.knobEmptyColor),a.knobTextColor&&(n=a.knobTextColor),a.knobTextAlign&&(i=a.knobTextAlign),a.knobTextDenominator&&(o=a.knobTextDenominator),"undefined"!=typeof a.knobTextShow&&(l=a.knobTextShow),"undefined"!=typeof a.knobAnimation&&(u=a.knobAnimation);var c={color:s};e(this).circleProgress({fill:c,emptyFill:r,animation:u});e(this).parents("ul")[0];e(this).on("circle-animation-progress",function(s,t){var r=e(this).data("circle-progress"),a=r.ctx,u=r.size,c=(100*t).toFixed(),d=(100*r.value).toFixed();c=100-c,d>c&&(c=d),a.save(),l&&(a.font=u/o+"px sans-serif",a.textAlign=i,a.textBaseline="middle",a.fillStyle=n,a.fillText(c+"%",u/2+u/80,u/2)),a.restore()}),e(this).on("circle-animation-end",function(){var s=e(this).data("circle-progress"),t=s.ctx,r=s.size,a=(100*s.value).toFixed();s.drawFrame(s.value),l&&(t.font=r/o+"px sans-serif",t.textAlign=i,t.textBaseline="middle",t.fillStyle=n,t.fillText(a+"%",r/2,r/2))});var p=e(this).data("circle-progress"),m=p.ctx,_=p.size,f=(100*p.value).toFixed();l&&(m.font=_/o+"px sans-serif",m.textAlign=i,m.textBaseline="middle",m.fillStyle=n,m.fillText(f+"%",_/2,_/2+_/80)),"undefined"!=typeof a.knobTextPrepend&&a.knobTextPrepend&&e(this).parent().prepend('<span class="progress">'+f+"%</span>")},CoursePress.unitProgressInit=function(){var s=e(".course-progress-disc");0<s.length&&s.each(CoursePress.UnitProgressIndicator)},CoursePress.Modal=Backbone.Modal.extend({viewContainer:".enrollment-modal-container",submitEl:".done",cancelEl:".cancel",options:"meh",initialize:function(){this.template=_.template(e("#modal-template").html()),this.views=this.getViews()},getViews:function(){var s={},t=e('[data-type="modal-step"]');if(0!==t.length)return e.each(t,function(t,r){var a=t+1,n=e(r).attr("id");void 0!==n&&(s["click #step"+a]={view:_.template(e("#"+n).html()),onActive:"setActive"})}),s},events:{"click .previous":"previousStep","click .next":"nextStep","click .cancel-link":"closeDialog"},previousStep:function(e){e.preventDefault(),this.previous(),"function"==typeof this.onPrevious&&this.onPrevious()},nextStep:function(e){e.preventDefault(),this.next(),"function"==typeof this.onNext&&this.onNext()},closeDialog:function(){return e(".enrolment-container-div").detach(),!1},setActive:function(e){this.trigger("modal:updated",{view:this,options:e})},cancel:function(){return e(".enrolment-container-div").detach(),!1}}),CoursePress.removeErrorHint=function(){e(this).removeClass("has-error")},CoursePress.actions=CoursePress.actions||{},CoursePress.filters=CoursePress.filters||{},CoursePress.add_action=function(e,s,t){void 0===t&&(t=10),CoursePress.actions[e]=CoursePress.actions[e]||[],CoursePress.actions[e].push({priority:t,callback:s})},CoursePress.add_filter=function(e,s,t){void 0===t&&(t=10),CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].push({priority:t,callback:s})},CoursePress.remove_action=function(e,s){CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].forEach(function(t,r){t.callback===s&&CoursePress.filters[e].splice(r,1)})},CoursePress.remove_filter=function(e,s){CoursePress.filters[e]=CoursePress.filters[e]||[],CoursePress.filters[e].forEach(function(t,r){t.callback===s&&CoursePress.filters[e].splice(r,1)})},CoursePress.do_action=function(e,s){var t=[];void 0!==CoursePress.actions[e]&&CoursePress.actions[e].length>0&&(CoursePress.actions[e].forEach(function(e){t[e.priority]=t[e.priority]||[],t[e.priority].push(e.callback)}),t.forEach(function(e){e.forEach(function(e){e(s)})}))},CoursePress.apply_filters=function(e,s,t){var r=[];return void 0!==CoursePress.filters[e]&&CoursePress.filters[e].length>0&&(CoursePress.filters[e].forEach(function(e){r[e.priority]=r[e.priority]||[],r[e.priority].push(e.callback)}),r.forEach(function(e){e.forEach(function(e){s=e(s,t)})})),s},CoursePress.procederDataLink=function(s){var t=s.currentTarget;e(t).data("link")&&(window.location.href=e(t).data("link"))},e(document).ready(CoursePress.unitProgressInit).on("focus",".cp-mask .has-error, .cp .has-error",CoursePress.removeErrorHint).on("click",".single_show_cart_button, .featured-course-link button",CoursePress.procederDataLink)}(jQuery),function(e){CoursePress.timer=function(e){var s=e.find(".quiz_timer").show(),t=e.find(".module-elements");if(0!==s.length){if(!t.is(":visible"))return void s.hide();var u,m,_,f,v,h,r=s.data("limit"),a=s.data("retry"),n=0,i=0,o=0,l=0,c=60,d="00",p="00";return r=r.split(":"),o=r.pop(),c=o=parseInt(o),r.length>0&&(d=i=r.pop(),i=60*parseInt(i)),r.length>0&&(p=n=r.pop(),n=60*parseInt(n)*60),l=n+i+o,_=e.find(".quiz_timer_info"),h=e.find(".module-elements input, .module_elements select, .module-elements textarea, .module-elements .video_player"),h.removeAttr("disabled"),v=function(){h.attr("disabled","disabled"),_.show()},0===l?void("no"===a?v():s.hide()):void(u=setInterval(function(){60==c&&parseInt(d)>0&&(d=parseInt(d)-1),c=parseInt(c)-1,0>=c&&0>=d&&0>=p&&(clearInterval(u),v(),f=new CoursePress.SendRequest,f.set({cpnonce:_coursepress.cpnonce,className:"CoursePress_Module",method:"record_expired_answer",module_id:e.data("id"),course_id:e.find('[name="course_id"]').val(),unit_id:e.find('[name="unit_id"]').val(),student_id:e.find('[name="student_id"]').val(),action:"record_time"}),f.save(),_.on("click",function(){h.removeAttr("disabled"),_.hide(),CoursePress.timer(e)})),0>c&&(c=59,parseInt(d)>0&&(d=parseInt(d)-1),parseInt(d)<=0&&parseInt(p)>0&&(p=parseInt(p)-1,d=59,10>p&&(p="0"+parseInt(p)))),10>c&&(c="0"+parseInt(c)),10>d&&(d="0"+parseInt(d)),m="00"==p?d+":"+c:p+":"+d+":"+c,s.html(m)},1e3))}},CoursePress.MediaElements=function(s){if(e.fn.mediaelementplayer){var t=e("audio,video",s);if(videojs.getPlayers()){videojs(t[0].id)}t.length>0&&t.mediaelementplayer()}},CoursePress.LoadFocusModule=function(){var s=e(this),t=s.data(),r=e(".coursepress-focus-view"),a=[_coursepress.home_url,"coursepress_focus"],n=e(".cp, .coursepress-focus-view");if("submit"!==s.attr("type")){if("course"===t.type)return void(window.location=t.url);if(t.unit){var i=n.find('[name="unit_id"]');if(0===i.length||t.unit!==i.val())return void(window.location=t.url)}return a.push(t.course,t.unit,t.type,t.id),a=a.join("/"),r.load(a,function(){CoursePress.resetBrowserURL(t.url),CoursePress.timer(r.find(".cp-module-content")),CoursePress.MediaElements(r.find(".cp-module-content"))}),!1}},CoursePress.validateUploadModule=function(){var s=e(this),t=s.parents(".module-elements").first(),r=t.find(".invalid-extension, .current-file"),a=s.val(),n=a.split(".").pop(),i=_.keys(_coursepress.allowed_student_extensions);if(0<r.length&&r.detach(),_.contains(i,n)){var o=s.get(0);if(o.files&&o.files.length)for(var l=0;l<o.files.length;l++)a=o.files[l].name;r=e('<div class="current-file"></div>').html(a),r.insertAfter(s.parent())}else r=e('<div class="invalid-extension">').insertAfter(s.parent()),r.html(_coursepress.invalid_upload_message)},CoursePress.ModuleSubmit=function(){var c,s=e(this),t=s.find(".cp-error-box"),r=s.parents(".coursepress-focus-view, .cp.unit-wrapper"),a=!1,n=!1,i=e('.module-elements[data-required="1"]',s),o=i.next(".module-response"),l=s.parents(".coursepress-focus-view").length>0,u=0,d=e("[name=save_progress_and_exit]").length<1;return 0<t.length&&t.remove(),d&&(i.each(function(){var r,s=e(this),t=s.data("type");_.contains(["input-checkbox","input-radio","input-quiz"],t)?(r=e(":checked",s),0==r.length&&(u+=1)):"input-upload"===t&&0===o.length?(r=e('[type="file"]',s),""===r.val()&&(u+=1)):_.contains(["input-text","input-textarea","input-select"],t)&&(r=e("input,textarea,select",s),""===r.val()&&(u+=1))}),u>0)?(new CoursePress.WindowAlert({message:_coursepress.module_error[l?"required":"normal_required"]}),!1):(c=CoursePress.Mask(),s.append('<input type="hidden" name="is_cp_ajax" value="1" />'),a=e('<iframe name="cp_submitter" style="display:none;">').insertBefore(s),s.attr("target","cp_submitter"),void a.on("load",function(){var s=e(this).contents().find("body");n=setInterval(function(){var e=s.text();if(""!=e){clearInterval(n),c.done();var t=window.JSON.parse(e);!0===t.success?t.data.url&&(!1===l||!0===t.data.is_reload||t.data.type&&"completion"===t.data.type?window.location=t.data.url:(r.html(t.data.html),CoursePress.resetBrowserURL(t.data.url),CoursePress.timer(r.find(".cp-module-content")),CoursePress.MediaElements(r.find(".cp-module-content")))):(t.data.html&&r.html(t.data.html),new CoursePress.WindowAlert({message:t.data.error_message}))}},100)}))},CoursePress.toggleModuleState=function(){var s=e(this),t=s.closest(".cp-module-content"),r=e(".module-elements",t),a=e(".module-response",t),n=e(".cp-is-hidden-module",t);return a.hide(),r.show(),n.val(0),CoursePress.timer(t),!1},CoursePress.commentReplyLink=function(){var s=e(this),t=s.parents("[data-comid]").first(),r=t.data("comid"),a=s.parents(".cp-module-content").first(),n=e("#respond",a),i=e("#comment-"+r),o=e('[name="comment_parent"]',n),l=e(".cp-temp-div"),u=n.find("#cancel-comment-reply-link");return 0===l.length&&(l=e('<div class="cp-temp-div"></div>').insertAfter(n)),o.val(r),n.hide(),i.append(n.slideDown()),u.off("click"),u.show().on("click",function(){return n.insertBefore(l),u.hide(),l.remove(),!1}),CoursePress.Focus(n),n.find('textarea[name="comment"]').focus(),!1},CoursePress.addComment=function(s){var g,b,t=e(this),r=t.parents(".cp-module-content").first(),a=e("#respond",r),n=e(".cp-comment-form",r),i=e('[name="comment"]',a),o=e('[name="comment_parent"]',a),l=e('[name="comment_post_ID"]',a),u=e('[name="coursepress_subscribe"]',a),c=e('[name="student_id"]',r),d=e('[name="course_id"]',r),p=e('[name="module_content"]',r),m=e(".cp-error-box",a),_=e(".comment-list",r),f={},v=0<parseInt(o.val()),h=new CoursePress.SendRequest;return m.remove(),""===i.val()?(new CoursePress.WindowAlert({message:_coursepress.comments.require_valid_comment}),s.stopImmediatePropagation(),!1):(f={comment:i.val(),comment_parent:o.val(),comment_post_ID:l.val(),subscribe:u.val(),cpnonce:_coursepress.cpnonce,method:"add_single_comment",className:"CoursePress_Module",course_id:d,unit_id:p,student_id:c.val(),action:"add_single_comment"},b=CoursePress.Mask(),g=function(){var e=a.find("#cancel-comment-reply-link");i.val(""),o.val(""),e.is(":visible")&&e.trigger("click"),b.done()},h.set(f),h.off("coursepress:add_single_comment_success"),h.on("coursepress:add_single_comment_success",function(s){g(),_>0&&(_=e('<ol class="comment-list"></ol>').insertAfter(a));var i,t=_,r=n.is(".comment-form-desc")?"append":"prepend";!0===v?(t=e("#comment-"+f.comment_parent),i=t.find(".children"),0===i.length?(t.append('<ul class="children"></ul>'),i=t.find(".children")):i="append"===r?i.last():i.first(),i[r](s.html)):t[r](s.html),CoursePress.Focus("#comment-"+s.comment_id)}),h.on("coursepress:add_single_comment_error",function(){b.done(),CoursePress.showError(_coursepress.server_error,a)}),h.save(),s.stopImmediatePropagation(),!1)},CoursePress.singleFolded=function(){var s=e(">ul",e(this).parent()),t=e(".unit-archive-single-title",e(this).parent()),r=e(".unit-archive-module-wrapper",e(this).parent()),a=e(this);return a.hasClass("folded")?s.slideDown(function(){a.removeClass("folded"),a.closest("li").removeClass("folded").addClass("unfolded"),t.attr("href",t.data("original-href")),t.off("click")}):s.slideUp(function(){if(a.addClass("folded"),a.closest("li").removeClass("unfolded").addClass("folded"),"undefined"==typeof t.data("href")){var s=e(".module-seen",r).last();if(s.length&&(s=e(".module-title",s),s.length))return t.attr("href",t.attr("href")+"#module-"+s.data("id")),!1;var n=e(".section-seen",r).last();if(n.length&&(n=e(".section-title",n),n.length))return t.attr("href",t.attr("href")+"#section-"+n.data("id")),!1}}),!1},CoursePress.unitFolded=function(){var s=e(this),t=s.parents("li").first(),r=t.find(".unit-structure-modules"),a=t.is(".folded");a?(t.removeClass("folded").addClass("unfolded"),s.removeClass("folded"),r.slideDown()):(t.removeClass("unfolded").addClass("folded"),s.addClass("folded"),r.slideUp())},CoursePress.saveProgressAndExit=function(){var s=e(this).closest("form");e("#respond",s).detach(),s.append('<input type="hidden" name="save_progress_and_exit" value="1" />'),s.submit()},CoursePress.hookModuleVideos=function(){e(".video-js").each(function(){var s=e(this).attr("id"),t=videojs(s);t.on("ready",function(){function r(s){e(s.el()).closest(".video_player").is('[disabled="disabled"]')&&s.pause()}var s=this,t=e(s.el());t.is("[autoplay]")&&s.play(),t.is("[muted]")&&s.muted(!0),s.one("click",function(){s.play()}),s.one("play",function(){CoursePress.timer(t.closest(".cp-module-content"))}),s.on("play",function(){r(s)}),s.on("timeupdate",function(){r(s)})})})},e(document).ready(function(){e(".cp-module-content").each(function(){var s=e(this);"video"!==s.data("type")&&CoursePress.timer(s)}),CoursePress.hookModuleVideos()}).on("submit",".cp-form",CoursePress.ModuleSubmit).on("click",".focus-nav-prev, .focus-nav-next",CoursePress.LoadFocusModule).on("click",".button-reload-module",CoursePress.toggleModuleState).on("click",".cp-module-content .comment-reply-link",CoursePress.commentReplyLink).on("click",".cp-comment-submit",CoursePress.addComment).on("change",".cp-module-content .file input",CoursePress.validateUploadModule).on("click",".unit-archive-single .fold",CoursePress.singleFolded).on("click",".course-structure-block .unit .fold, .unit-archive-list .fold",CoursePress.unitFolded).on("click",".save-progress-and-exit",CoursePress.saveProgressAndExit)}(jQuery),function(e){function s(s){if(void 0===s)return!1;var a,t=e(e('[data-type="modal-step"]')[s]).attr("data-modal-action"),r=e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce");if(CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action",t),!("signup"===t&&(a=CoursePress.Enrollment.dialog.signup_validation,"function"==typeof a&&!0!==a())||"login"===t&&(a=CoursePress.Enrollment.dialog.login_validation,"function"==typeof a&&!0!==a()))){var n={nonce:r,step:s};a=CoursePress.Enrollment.dialog[t+"_data"],"function"==typeof a&&(n=a(n)),"signup"==t&&e("input.signup").after('<span class="fa fa-circle-o-notch fa-spin fa-2x fa-fw"></span>'),CoursePress.Post.set("data",n),CoursePress.Post.save(),CoursePress.Post.on("coursepress:enrollment:"+t+"_success",function(s){return e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",s.nonce),void 0!==s.callback&&(a=CoursePress.Enrollment.dialog[s.callback],"function"==typeof a)?void a(s):void(void 0!==s.last_step&&parseInt(s.last_step)<CoursePress.Enrollment.dialog.views.length-1&&(CoursePress.Enrollment.dialog.openAt(parseInt(s.last_step)+1),e(".enrolment-container-div").removeClass("hidden")))}),CoursePress.Post.on("coursepress:enrollment:"+t+"_error",function(e){return void 0!==e.callback&&(a=CoursePress.Enrollment.dialog[e.callback],"function"==typeof a)?void a(e):void 0})}}CoursePress.Models.CourseFront=Backbone.Model.extend({url:_coursepress._ajax_url+"?action=course_front",parse:function(e){!0===e.success?(this.set("response_data",e.data),this.trigger("coursepress:"+e.data.action+"_success",e.data)):(this.set("response_data",{}),e.data&&this.trigger("coursepress:"+e.data.action+"_error",e.data))},defaults:{}}),CoursePress.Models.Post=CoursePress.Models.Post||Backbone.Model.extend({url:_coursepress._ajax_url+"?action=",parse:function(e){var s=this.get("context");if(!0===e.success){void 0===e.data&&(e.data={}),this.set("response_data",e.data);var t="coursepress:"+s+e.data.action+"_success";this.trigger(t,e.data)}else 0!==e&&(this.set("response_data",{}),this.trigger("coursepress:"+s+e.data.action+"_error",e.data));CoursePress.Post.set("action","")},prepare:function(e,s){this.url=this.get("base_url")+e,void 0!==s&&this.set("context",s)},defaults:{base_url:_coursepress._ajax_url+"?action=",context:"response:"}}),CoursePress.Post=new CoursePress.Models.Post,CoursePress.checkWeakPassword=function(){var s=e(this).closest("form"),t=e('[name="password"]',s),r=e('[name="password_confirmation"]',s),a=e(".password-strength-meter",s),n=e(".weak-password-confirm",s),i=e('[name="password_strength_level"]',s);if("undefined"!=typeof wp.passwordStrength.meter&&_coursepress.password_strength_meter_enabled){var o=t.val(),l=r.val();if(n.hide(),a.removeClass("short bad good strong").html(""),o||l){var u=wp.passwordStrength.meter(o,wp.passwordStrength.userInputBlacklist(),l);switch(i.val(u),u){case 2:a.addClass("bad").html(pwsL10n.bad);break;case 3:a.addClass("good").html(pwsL10n.good);break;case 4:a.addClass("strong").html(pwsL10n.strong);break;case 5:a.addClass("bad").html(pwsL10n.mismatch);break;default:a.addClass("bad").html(pwsL10n.short)}3>u&&n.show()}}},CoursePress.Dialogs={beforeSubmit:function(){var t=this.currentIndex;return s(t),t===CoursePress.Enrollment.dialog.views.length-1&&e(".enrolment-container-div").addClass("hidden"),!1},openAtAction:function(s){var t=e('[data-type="modal-step"]');e.each(t,function(t,r){var a=e(r).attr("data-modal-action");void 0!==a&&s===a&&(CoursePress.Enrollment.dialog.openAt(t),"login"==s&&e(window).scrollTop(e("div.cp-mask.enrolment-container-div").offset().top-100))})},handle_signup_return:function(s){var t=s.signup_errors,r=e('[data-type="modal-step"]');if(e("span.fa-circle-o-notch").detach(),0===t.length&&s.user_data.logged_in===!0)_coursepress.invitation_data?CoursePress.Enrollment.dialog.add_instructor(s):e.each(r,function(t,r){var a=e(r).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===a&&"no"===_coursepress.current_course_has_second_formula?CoursePress.Enrollment.dialog.openAt(t):"enrolled"===a&&(s.already_enrolled?location.href=_coursepress.course_url:CoursePress.Enrollment.dialog.attempt_enroll(s))});else if(t.length>0){e(".bbm-wrapper #error-messages").html("");var a="<ul>";t.forEach(function(e){a+="<li>"+e+"</li>"}),a+="</ul>",e(".bbm-wrapper #error-messages").html(a),e("input[name=password]").val(""),e("input[name=password_confirmation]").val("")}else e.each(r,function(e,s){var t=s.attr("data-modal-action");"login"===t&&CoursePress.Enrollment.dialog.openAt(e)})},handle_login_return:function(s){var t=s.signup_errors,r=e('[data-type="modal-step"]');if(0===t.length&&s.logged_in===!0)_coursepress.invitation_data?CoursePress.Enrollment.dialog.add_instructor(s):e.each(r,function(t,r){var a=e(r).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===a&&"no"===_coursepress.current_course_has_second_formula?CoursePress.Enrollment.dialog.openAt(t):"enrolled"===a&&(s.already_enrolled?location.href=_coursepress.course_url:CoursePress.Enrollment.dialog.attempt_enroll(s))});else if(t.length>0){e(".bbm-wrapper #error-messages").html("");var a="<ul>";t.forEach(function(e){a+="<li>"+e+"</li>"}),a+="</ul>",e(".bbm-wrapper #error-messages").html(a),e("input[name=password]").val("")}},handle_enroll_student_return:function(s){var t=e('[data-type="modal-step"]');!0===s.success?e.each(t,function(s,t){var r=e(t).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===r&&"no"===_coursepress.current_course_has_second_formula?CoursePress.Enrollment.dialog.openAt(s):"enrolled"===r&&CoursePress.Enrollment.dialog.openAt(s)}):e.each(t,function(s,t){var r=e(t).attr("data-modal-action");"passcode"==_coursepress.current_course_type&&"passcode"===r&&CoursePress.Enrollment.dialog.openAt(s)}),e(".enrolment-container-div").removeClass("hidden")},signup_validation:function(){var s=!0;e(".bbm-wrapper #error-messages").html("");var t="div.enrolment-container-div ",r=[],a=e(t+'[name="password"]').val().trim(),n=e(t+'[name="password_confirmation"]').val().trim();if((""===e(t+"input[name=first_name]").val().trim()||""===e(t+"input[name=last_name]").val().trim()||""===e(t+"input[name=username]").val().trim()||""===e(t+"input[name=email]").val().trim()||""===a||""===n)&&(s=!1,r.push(_coursepress.signup_errors.all_fields)),a!==n&&(s=!1,r.push(_coursepress.signup_errors.mismatch_password)),"undefined"!=typeof wp.passwordStrength.meter&&_coursepress.password_strength_meter_enabled){var i=e(t+'[name="confirm_weak_password"]'),o=wp.passwordStrength.meter(a,[],n);2>=o&&!i.is(":checked")&&(s=!1,r.push(_coursepress.signup_errors.weak_password))}if(r.length>0){var l="<ul>";r.forEach(function(e){l+="<li>"+e+"</li>"}),l+="</ul>",e(".bbm-wrapper #error-messages").first().html(l)}return s},login_validation:function(){var s=!0,t="div.enrolment-container-div ",r=e(".bbm-wrapper #error-messages"),a=e(t+'input[name="log"]'),n=e(t+'input[name="pwd"]');return r.html(""),a.removeClass("has-error"),n.removeClass("has-error"),""===a.val().trim()&&(s=!1,a.addClass("has-error")),""===n.val().trim()&&(s=!1,n.addClass("has-error")),s},signup_data:function(s){var t="div.enrolment-container-div ";return s.first_name=e(t+"input[name=first_name]").val(),s.last_name=e(t+"input[name=last_name]").val(),s.username=e(t+"input[name=username]").val(),s.email=e(t+"input[name=email]").val(),s.password=e(t+"input[name=password]").val(),s.nonce=e(".bbm-modal-nonce.signup").attr("data-nonce"),s},login_data:function(s){var t="div.enrolment-container-div ",r=e(".enrollment-modal-container.bbm-modal__views").attr("data-course");return s.username=e(t+"input[name=log]").val(),s.password=e(t+"input[name=pwd]").val(),s.course_id=r,s.nonce=e(".bbm-modal-nonce.login").attr("data-nonce"),s},attempt_enroll:function(s){var t=e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce"),r=e(".enrollment-modal-container.bbm-modal__views").attr("data-course"),a=e(".cp-mask");if(void 0===t||void 0===r){var n=e(document.createElement("div"));n.html(_.template(e("#modal-template").html())()),n=e(n).find(".enrollment-modal-container")[0],t=e(n).attr("data-nonce"),r=e(n).attr("data-course");var i=e(n).attr("data-group-tag-free")}CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","enroll_student");var o={nonce:t,student_id:s.user_data.ID,course_id:r,step:"",group:i};CoursePress.Post.set("data",o),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:enroll_student_error"),CoursePress.Post.on("coursepress:enrollment:enroll_student_error",function(e){if(void 0!==e.callback){var s=CoursePress.Enrollment.dialog[e.callback];if("function"==typeof s)return void s(e)}}),CoursePress.Post.off("coursepress:enrollment:enroll_student_success"),CoursePress.Post.on("coursepress:enrollment:enroll_student_success",function(s){if(a.removeClass("loading"),e(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",s.nonce),void 0!==s.callback){var t=CoursePress.Enrollment.dialog[s.callback];if("function"==typeof t)return void t(s)}})},new_nonce:function(e,s){CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","get_nonce");var t={action:"get_nonce",nonce:e,step:""};CoursePress.Post.set("data",t),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:get_nonce_success"),CoursePress.Post.on("coursepress:enrollment:get_nonce_success",s)},add_instructor:function(e){CoursePress.Enrollment.dialog.new_nonce("coursepress_add_instructor",function(s){var t=_coursepress.invitation_data.course_id;CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","add_instructor");var r={action:"add_instructor",nonce:s.nonce,course_id:t,invite_code:_coursepress.invitation_data.code,instructor_id:e.user_data.ID,step:""};CoursePress.Post.set("data",r),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:add_instructor_success"),CoursePress.Post.on("coursepress:enrollment:add_instructor_success",function(){CoursePress.Enrollment.dialog.openAtAction("instructor-verified")}),CoursePress.Post.off("coursepress:enrollment:add_instructor_error"),CoursePress.Post.on("coursepress:enrollment:add_instructor_error",function(){CoursePress.Enrollment.dialog.openAtAction("verification-failed")})})},init:function(){CoursePress.Enrollment.dialog||(CoursePress.Enrollment.dialog=new CoursePress.Modal,_.extend(CoursePress.Enrollment.dialog,CoursePress.Dialogs))}},CoursePress.Enrollment=CoursePress.Enrollment||{},CoursePress.CustomLoginHook=function(){e(this).attr("href","#");var s=e('<div class="cp-mask enrolment-container-div">');return s.appendTo("body"),CoursePress.Dialogs.init(),s.html(CoursePress.Enrollment.dialog.render().el),CoursePress.Enrollment.dialog.openAtAction("login"),!1},CoursePress.EnrollStudent=function(){var s=e('<div class="cp-mask enrolment-container-div">');if(s.appendTo("body"),CoursePress.Dialogs.init(),"yes"===_coursepress.current_course_is_paid&&"no"===_coursepress.current_course_has_second_formula)e(s).html(CoursePress.Enrollment.dialog.render().el),CoursePress.Enrollment.dialog.openAtAction("paid_enrollment");else{e(s).addClass("loading");var t={user_data:{ID:parseInt(_coursepress.current_student)}};CoursePress.Enrollment.dialog.attempt_enroll(t),e(s).html(CoursePress.Enrollment.dialog.render().el)}return!1},CoursePress.validateEnrollment=function(){e(this);return!1},CoursePress.validatePassCode=function(){var s=e(this),t=s.find('[name="passcode"]');return student_id=s.find('[name="student_id"]').val(),course_id=s.find('[name="course_id"]').val(),""===t.val()?(new CoursePress.WindowAlert({message:_coursepress.module_error.passcode_required}),!1):(CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","enroll_with_passcode"),CoursePress.Post.set("data",{passcode:t.val(),student_id:student_id,course_id:course_id,step:0}),CoursePress.Post.off("coursepress:enrollment:enroll_with_passcode_success"),CoursePress.Post.on("coursepress:enrollment:enroll_with_passcode_success",function(){var t=e('<div class="cp-mask enrolment-container-div">');t.appendTo("body"),CoursePress.Dialogs.init(),e(t).html(CoursePress.Enrollment.dialog.render().el),CoursePress.Enrollment.dialog.openAtAction("enrolled")}),CoursePress.Post.off("coursepress:enrollment:enroll_with_passcode_error"),CoursePress.Post.on("coursepress:enrollment:enroll_with_passcode_error",function(e){new CoursePress.WindowAlert({message:e.message})}),CoursePress.Post.save(),!1)},e(document).on("click",".cp-custom-login",CoursePress.CustomLoginHook).on("click",".apply-button.enroll",CoursePress.EnrollStudent).on("submit",'[name="enrollment-process"][data-type="passcode"]',CoursePress.validatePassCode).on("keyup",'.signup-form [name="password"], .signup-form [name="password_confirmation"], .student-settings [name="password"], .student-settings [name="password_confirmation"]',CoursePress.checkWeakPassword).on("submit",".apply-box .enrollment-process",CoursePress.validateEnrollment)}(jQuery),function(e){var s=function(){{var s=e(this).attr("href");new CoursePress.WindowAlert({type:"prompt",message:_coursepress.confirmed_withdraw,callback:function(){window.location=s}})}return!1},t=function(){{var s=e(this).data("link");new CoursePress.WindowAlert({type:"prompt",message:_coursepress.confirmed_edit,callback:function(){window.location=s}})}return!1};e(document).on("click",".cp-withdraw-student",s).on("click",".coursepress-course-link",t)}(jQuery);